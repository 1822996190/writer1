<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.writer1.entity">
    <insert id="addPosts" parameterType="Posts">
        insert into posts (author,sdate,category,content,title)
        values (#{author},#{sdate},#{category},#{content},#{title})
    </insert>
    <select id="queryAllPosts" resultType="Posts">
        select id,author,sdate,category,content,title,totalComments from posts
    </select>
    <select id="queryMyPosts" parameterType="string" resultType="Posts">
        select id,author,sdate,category,content,title,totalComments from posts
        where author=#{author}
    </select>
    <update id="addTotalComments" parameterType="integer">
        update posts set totalComments=totalComments+1 where
        id=#{sid}
    </update>
    <select id="fuzzyQueryPosts" parameterType="java.util.Map" resultType="Posts">
        select id,author,sdate,category,content,title,totalComments from posts
        <where>
            <if test="key_words!=null">
                and (title like concat('%',#{key_words},'%')
                or content like concat('%',#{key_words},'%'))
            </if>
            <if test="category!='All'">
                and category=#{category}
            </if>
            <if test="author!='All'">
                and author=#{author}
            </if>
        </where>
    </select>
    <select id="queryByCategory" parameterType="string" resultType="Posts">
        select id,author,sdate,category,content,title,totalComments from posts
        <where>
            <if test="category!='All'">
                and category=#{category}
            </if>
            <if test="author!='All'">
                and author=#{author}
            </if>
        </where>
    </select>
</mapper>